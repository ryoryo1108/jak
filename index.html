// 簡易アクセス制限
const urlParams = new URLSearchParams(window.location.search);
const key = urlParams.get('key');
if (key !== 'my-secret-key') {
  document.getElementById('auth').innerHTML = "<p>アクセス拒否</p>";
} else {
  document.getElementById('app').style.display = "block";
}

// 曲一覧（曲名と秒数）
const songs = [
  { title: "Intro", seconds: 45 },
  { title: "Rage Anthem", seconds: 120 },
  { title: "Breakdown", seconds: 180 },
  { title: "New Song", seconds: 150 },
  { title: "Encore", seconds: 90 }
];

const table = document.getElementById('songTable');
const setlistEl = document.getElementById('setlist');
const totalTimeEl = document.getElementById('totalTime');

function formatTime(totalSec) {
  const m = Math.floor(totalSec / 60);
  const s = totalSec % 60;
  return ${m}:${s.toString().padStart(2, '0')};
}

// 表を作る
function renderTable() {
  table.innerHTML = 
    <tr><th>選択</th><th>順番</th><th>曲名</th><th>時間</th></tr>
  ;

  songs.forEach((song, idx) => {
    const row = document.createElement('tr');
    row.innerHTML = 
      <td><input type="checkbox" data-idx="${idx}" /></td>
      <td><input type="number" min="1" data-order="${idx}" /></td>
      <td>${song.title}</td>
      <td>${formatTime(song.seconds)}</td>
    ;
    table.appendChild(row);
  });

  // イベント設定
  table.querySelectorAll('input').forEach(input => {
    input.addEventListener('change', renderSetlist);
  });
}

// セットリスト表示
function renderSetlist() {
  const selected = [];

  table.querySelectorAll('tr').forEach((row, i) => {
    if (i === 0) return; // ヘッダ

    const checkbox = row.querySelector('input[type="checkbox"]');
    const orderInput = row.querySelector('input[type="number"]');
    const idx = parseInt(checkbox.dataset.idx);

    if (checkbox.checked) {
      const order = parseInt(orderInput.value);
      if (!isNaN(order)) {
        selected.push({ order, song: songs[idx] });
        row.classList.add('selected');
      } else {
        row.classList.remove('selected');
      }
    } else {
      row.classList.remove('selected');
    }
  });

  selected.sort((a, b) => a.order - b.order);

  setlistEl.innerHTML = '';
  let total = 0;
  selected.forEach(item => {
    const li = document.createElement('li');
    li.textContent = ${item.order}. ${item.song.title} (${formatTime(item.song.seconds)});
    setlistEl.appendChild(li);
    total += item.song.seconds;
  });

  totalTimeEl.textContent = formatTime(total);
}

renderTable();